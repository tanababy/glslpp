(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{32:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return r});var i=n(12),s=n.n(i),o=n(13),a=n.n(o),r=function(){function t(n,i,o,a,r){var u=this;s()(this,t),this.DOM={},this.DOM.container=document.getElementById("canvas-container"),this.geometry,this.material,this.camera=new e.Camera,this.scene=new e.Scene,this.mesh,this.loader=new e.TextureLoader,this.renderer=new e.WebGLRenderer,this.vertexShader=n,this.fragmentShader=i,this.intensity=.5,this.speedIn=1.6,this.speedOut=1.2,this.easing=Expo.easeOut,this.texturePath1=o||null,this.texturePath2=a||null,this.texturePath3=r||null,this.texture1,this.texture2,this.texture3,this.uniforms={time:{type:"f",value:1},resolution:{type:"v2",value:new e.Vector2},imageResolution:{type:"v2",value:new e.Vector2(1280,849)},u_mouse:{type:"v2",value:new e.Vector2},u_texture1:{type:"t",value:this.texture1},u_texture2:{type:"t",value:this.texture2},u_texture3:{type:"t",value:this.texture3},effectFactor:{type:"f",value:this.intensity},dispFactor:{type:"f",value:0}},this.mousemoveFn=function(e){u.mouseCoordGet(e)},this.initDomEvents(),this.initThree()}return a()(t,[{key:"initDomEvents",value:function(){document.addEventListener("mousemove",this.mousemoveFn,!1)}},{key:"mouseCoordGet",value:function(e){this.uniforms.u_mouse.value.x=e.pageX,this.uniforms.u_mouse.value.y=e.pageY}},{key:"initThree",value:function(){this.setCanvas(),this.setPixelRatio(),this.setCamera(),this.setGeometry(),this.texturePath1&&(this.uniforms.u_texture1.value=this.textureLoad(this.texturePath1)),this.texturePath2&&(this.uniforms.u_texture2.value=this.textureLoad(this.texturePath2)),this.texturePath3&&(this.uniforms.u_texture3.value=this.textureLoad(this.texturePath3)),this.setShaderMaterial(this.vertexShader,this.fragmentShader),this.addScene(),this.setCanvasSize(),this.renderTick()}},{key:"textureLoad",value:function(t){var n;return(n=this.loader.load("".concat(t))).magFilter=e.LinearFilter,n.minFilter=e.LinearFilter,n.anisotropy=this.renderer.capabilities.getMaxAnisotropy(),n}},{key:"updateTexture",value:function(e,t,n){var i=this;e&&this.loader.load("".concat(e),function(e){i.material.uniforms.u_texture1.value=e}),t&&this.loader.load("".concat(t),function(e){i.material.uniforms.u_texture2.value=e}),n&&this.loader.load("".concat(n),function(e){i.material.uniforms.u_texture3.value=e})}},{key:"dispFactorIn",value:function(){TweenMax.to(this.material.uniforms.dispFactor,this.speedIn,{value:1,ease:this.easing})}},{key:"dispFactorOut",value:function(){TweenMax.to(this.material.uniforms.dispFactor,this.speedOut,{value:0,ease:this.easing})}},{key:"setGeometry",value:function(){this.geometry=new e.PlaneBufferGeometry(2,2)}},{key:"setPixelRatio",value:function(){this.renderer.setPixelRatio(window.devicePixelRatio)}},{key:"setCanvas",value:function(){this.DOM.container.appendChild(this.renderer.domElement)}},{key:"setCanvasSize",value:function(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.uniforms.resolution.value.x=this.renderer.domElement.width,this.uniforms.resolution.value.y=this.renderer.domElement.height}},{key:"setCamera",value:function(){this.camera.position.z=1}},{key:"setShaderMaterial",value:function(t,n){this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:t,fragmentShader:n,transparent:!0,opacity:1})}},{key:"addScene",value:function(){this.mesh=new e.Mesh(this.geometry,this.material),this.scene.add(this.mesh)}},{key:"renderTick",value:function(){this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.renderTick.bind(this)),this.uniforms.time.value+=.05}}]),t}()}).call(this,n(34))},33:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(12),s=n.n(i),o=n(13),a=n.n(o),r=function(){function e(t){var n=this;s()(this,e),this.DOM={el:t},this.DOM.tipIcon=this.DOM.el.firstElementChild,this.mousemoveFn=function(e){n.tilt(e)},this.mouseleaveFn=function(e){n.removeTilt(e)},this.initEvents()}return a()(e,[{key:"initEvents",value:function(){this.DOM.el.addEventListener("mousemove",this.mousemoveFn),this.DOM.el.addEventListener("mouseleave",this.mouseleaveFn)}},{key:"tilt",value:function(e){var t=function(e){var t=0,n=0,i=document.body.scrollLeft+document.documentElement.scrollLeft,s=document.body.scrollTop+document.documentElement.scrollTop;return e||(e=window.event),e.pageX||e.pageY?(t=e.pageX,n=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:t-i,y:n-s}}(e),n={x:[-20,20],y:[-20,20]},i=this.DOM.tipIcon.getBoundingClientRect();TweenMax.to(this.DOM.tipIcon,2,{ease:Expo.easeOut,x:(n.x[1]-n.x[0])/i.width*(t.x-(i.left+window.pageXOffset)+document.body.scrollLeft)+n.x[0],y:(n.y[1]-n.y[0])/i.height*(t.y-(i.top+window.pageYOffset)+document.body.scrollTop)+n.y[0]})}},{key:"removeTilt",value:function(){TweenMax.to(this.DOM.tipIcon,1,{ease:Elastic.easeOut.config(1,.4),x:0,y:0})}}]),e}()},39:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiPjxyZWZzPjxzdHlsZT5wYXRoIHtmaWxsOiAjZmZmO308L3N0eWxlPjwvcmVmcz48cGF0aCBkPSJNNCAuNzU1bDE0LjM3NCAxMS4yNDUtMTQuMzc0IDExLjIxOS42MTkuNzgxIDE1LjM4MS0xMi0xNS4zOTEtMTItLjYwOS43NTV6Ii8+PC9zdmc+"},72:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"single-component"},[i("ul",{staticClass:"single-component__list"},[i("li",{staticClass:"single-component__list-item",attrs:{"data-img":"../assets/img/distortion/texture1.jpg","data-disp":"../assets/img/common/displacement/1.jpg"},on:{mouseenter:e.hoverChangeTexture,mouseleave:function(t){return e.DispFactOut()}}},[e._v("Shinjuku")]),i("li",{staticClass:"single-component__list-item",attrs:{"data-img":"../assets/img/distortion/texture2.jpg","data-disp":"../assets/img/common/displacement/2.jpg"},on:{mouseenter:e.hoverChangeTexture,mouseleave:function(t){return e.DispFactOut()}}},[e._v("Minato")]),i("li",{staticClass:"single-component__list-item",attrs:{"data-img":"../assets/img/distortion/texture3.jpg","data-disp":"../assets/img/common/displacement/3.jpg"},on:{mouseenter:e.hoverChangeTexture,mouseleave:function(t){return e.DispFactOut()}}},[e._v("Shibuya")])]),i("div",{staticClass:"single-component__arrow-right"},[i("router-link",{staticClass:"single-component__arrow-inner",attrs:{to:"/dragon-quest-gate"}},[i("img",{attrs:{src:n(39)}})])],1),e._m(0),i("div",{staticClass:"canvas-container",attrs:{id:"canvas-container"}})])};i._withStripped=!0;var s=n(32),o=n(33),a={name:"Distortion",data:function(){return{activeArticle:"",threeCompile:""}},mounted:function(){var e=this;setTimeout(function(){e.canvasInit(),e.mouseInteraction()},1e3)},beforeCreate:function(){document.body.className="underlayer"},methods:{canvasInit:function(){this.threeCompile=new s.a("#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}","// #pragma glslify: random = require(glsl-random)\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec2 vUv;\n\nuniform sampler2D u_texture1;//sampler2Dは変数の型\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\nuniform vec2 resolution;\nuniform vec2 imageResolution;\n\nuniform float dispFactor;\nuniform float effectFactor;\n\nvoid main() {\n\n    vec2 ratio = vec2(\n      min((resolution.x / resolution.y) / (imageResolution.x / imageResolution.y), 1.0),\n      min((resolution.y / resolution.x) / (imageResolution.y / imageResolution.x), 1.0)\n    );\n\n    vec2 uv = vec2(\n      vUv.x * ratio.x + (1.0 - ratio.x) * 0.5,\n      vUv.y * ratio.y + (1.0 - ratio.y) * 0.5\n    );\n\n    vec4 disp = texture2D(u_texture3, uv);\n    //texture2DはGLSLの組み込み関数。テクスチャから色情報を抜き出すもの。だからoutputはテクスチャの色情報。\n    //第一引数はテクスチャ、第二引数はUV座標。\n    //「テクスチャーとは形状の情報しか持っていない3Dデータに対して、色や質感を与える情報のこと」\n\n    vec2 distortedPosition = vec2(uv.x + dispFactor * (disp.r*effectFactor), uv.y);\n    vec2 distortedPosition2 = vec2(uv.x - (1.0 - dispFactor) * (disp.r*effectFactor), uv.y);\n    //まずは、uv座標をいじっていると考える。\n    //uv座標をいじったりすることで、例えばぐにゃぐにゃにしたりできる。\n    //\n    //dispFactorの値は、hoverする・しないで0と1の値が変化する（TweenMaxでいじってる）\n    //参考 : https://nogson2.hatenablog.com/entry/2017/11/01/190122\n    //disp変数はvec4型(r,g,b,a)。disp.rはその第一引数を取り出している。\n    //\n\n    vec4 _texture1 = texture2D(u_texture1, distortedPosition);\n    vec4 _texture2 = texture2D(u_texture2, distortedPosition2);\n\n    vec4 finalTexture = mix(_texture1, _texture2, dispFactor);\n    //mix(x, y, a)は、x(1-a)+y*aを返す（つまり線形補間）\n    //aは混ぜる割合的な。\n    //例えば、赤と青を0.5の割合で混ぜると紫になる。\n\n    gl_FragColor = finalTexture;\n    // gl_FragColor = _texture1;\n}")},mouseInteraction:function(){for(var e=document.getElementsByClassName("single-component__arrow-inner"),t=0;t<e.length;t++)new o.a(e[t])},hoverChangeTexture:function(e){var t=e.currentTarget.getAttribute("data-img"),n=e.currentTarget.getAttribute("data-disp");this.threeCompile.updateTexture("../assets/img/common/black-canvas.jpg",t,n),this.threeCompile.dispFactorIn()},DispFactIn:function(){},DispFactOut:function(){this.threeCompile.dispFactorOut()}}},r=n(1),u=Object(r.a)(a,i,[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"single-component__info"},[n("h2",{staticClass:"single-component__title"},[e._v("Distortion Effect")]),n("p",{staticClass:"single-component__date"},[e._v("2019/07/16")]),n("p",{staticClass:"single-component__desc"},[e._v("参考: "),n("a",{attrs:{href:"https://tympanus.net/codrops/2018/04/10/webgl-distortion-hover-effects/",target:"_blank"}},[e._v("WebGL Distortion Hover Effects | Codrops")]),n("br"),e._v('ディストーションエフェクト。"DragonQuestGate"と原理は同じで、テクスチャ座標を特定の計算式で歪ませる。'),n("br"),e._v("その計算式では、dislayment画像というエフェクトを生み出す画像のテクスチャ座標を使用する。"),n("br"),e._v("表示したい画像のテクスチャと、黒一色のテクスチャの座標を線形補間し、canvasに表示させる。"),n("br"),e._v("また、ホバー毎にテクスチャをthree.js側で入れ替えている。")])])}],!1,null,"64018584",null);u.options.__file="src/components/pages/distortion/Distortion.vue";t.default=u.exports}}]);